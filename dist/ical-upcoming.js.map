{"version":3,"sources":["../src/ical-upcoming.ts"],"names":[],"mappings":"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","file":"ical-upcoming.js","sourcesContent":["import { Red, Node } from 'node-red';\r\nimport { CronJob } from 'cron';\r\nimport { Config } from './ical-config';\r\nimport * as moment from 'moment';\r\nimport { getICal, CalEvent, countdown, addOffset, getTimezoneOffset } from './helper';\r\n\r\nvar parser = require('cron-parser');\r\nvar RRule = require('rrule').RRule;\r\n\r\nvar ce = require('cloneextend');\r\n\r\nmodule.exports = function (RED: Red) {\r\n    function upcomingNode(config: any) {\r\n        RED.nodes.createNode(this, config);\r\n\r\n        let configNode = (RED.nodes.getNode(config.confignode) as unknown) as Config;\r\n        this.config = configNode;\r\n        this.filter = config.filter;\r\n        this.trigger = config.trigger || 'always';\r\n        this.endpreview = config.endpreview || 10;\r\n        this.endpreviewUnits = config.endpreviewUnits || 'd';\r\n        this.pastview = config.pastview || 0;\r\n        this.pastviewUnits = config.pastviewUnits || 'd';\r\n\r\n        this.on('input', () => {\r\n            cronCheckJob(this);\r\n        });\r\n        try {\r\n            let cron = '';\r\n\r\n            if (config.timeout && config.timeout !== '' && parseInt(config.timeout) > 0 && config.timeoutUnits && config.timeoutUnits !== '') {\r\n                switch (config.timeoutUnits) {\r\n                    case 'seconds':\r\n                        cron = `*/${config.timeout} * * * * *`;\r\n                        break;\r\n                    case 'minutes':\r\n                        cron = `0 */${config.timeout} * * * *`;\r\n                        break;\r\n                    case 'hours':\r\n                        cron = `0 0 */${config.timeout} * * *`;\r\n                        break;\r\n                    case 'days':\r\n                        cron = `0 0 0 */${config.timeout} * *`;\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n            if (config.cron && config.cron !== '') {\r\n                parser.parseExpression(config.cron);\r\n                cron = config.cron;\r\n            }\r\n\r\n            if (cron !== '') {\r\n                this.job = new CronJob(cron, cronCheckJob.bind(null, this, configNode));\r\n\r\n                this.on('close', () => {\r\n                    this.job.stop();\r\n                    this.debug('cron stopped');\r\n                });\r\n\r\n                this.job.start();\r\n            }\r\n        } catch (err) {\r\n            this.error('Error: ' + err.message);\r\n            this.status({ fill: 'red', shape: 'ring', text: err.message });\r\n        }\r\n    }\r\n\r\n    function cronCheckJob(node: any) {\r\n        if (node.job && node.job.running) {\r\n            node.status({ fill: 'green', shape: 'dot', text: node.job.nextDate().toISOString() });\r\n        } else {\r\n            node.status({});\r\n        }\r\n\r\n        node.datesArray_old = ce.clone(node.datesArray);\r\n        node.datesArray = [];\r\n        checkICal(\r\n            node.config.url,\r\n            (data, err) => {\r\n                if (err) {\r\n                    node.error('Error: ' + err);\r\n                    node.status({ fill: 'red', shape: 'ring', text: err.message });\r\n                    return;\r\n                }\r\n\r\n                displayDates(node, node.config);\r\n            },\r\n            node,\r\n            node.config\r\n        );\r\n    }\r\n\r\n    function processRRule(ev, endpreview, today, realnow, node, config) {\r\n        var eventLength = ev.end.getTime() - ev.start.getTime();\r\n\r\n        var options = RRule.parseString(ev.rrule.toString());\r\n        options.dtstart = addOffset(ev.start, -getTimezoneOffset(ev.start));\r\n        if (options.until) {\r\n            options.until = addOffset(options.until, -getTimezoneOffset(options.until));\r\n        }\r\n        node.debug('options:' + JSON.stringify(options));\r\n\r\n        var rule = new RRule(options);\r\n        var now2 = new Date();\r\n        now2.setHours(0, 0, 0, 0);\r\n        var now3 = new Date(now2.getTime() - eventLength);\r\n        if (now2 < now3) now3 = now2;\r\n        node.debug(\r\n            'RRule event:' +\r\n            ev.summary +\r\n            '; start:' +\r\n            ev.start.toString() +\r\n            '; endpreview:' +\r\n            endpreview.toString() +\r\n            '; today:' +\r\n            today +\r\n            '; now2:' +\r\n            now2 +\r\n            '; now3:' +\r\n            now3 +\r\n            '; rule:' +\r\n            JSON.stringify(rule)\r\n        );\r\n\r\n        var dates = [];\r\n        try {\r\n            dates = rule.between(now3, endpreview, true);\r\n        } catch (e) {\r\n            node.error(\r\n                'Issue detected in RRule, event ignored; ' +\r\n                e.stack +\r\n                '\\n' +\r\n                'RRule object: ' +\r\n                JSON.stringify(rule) +\r\n                '\\n' +\r\n                'now3: ' +\r\n                now3 +\r\n                '\\n' +\r\n                'endpreview: ' +\r\n                endpreview +\r\n                '\\n' +\r\n                'string: ' +\r\n                ev.rrule.toString() +\r\n                '\\n' +\r\n                'options: ' +\r\n                JSON.stringify(options)\r\n            );\r\n        }\r\n\r\n        node.debug('dates:' + JSON.stringify(dates));\r\n\r\n        if (dates.length > 0) {\r\n            for (var i = 0; i < dates.length; i++) {\r\n                var ev2 = ce.clone(ev);\r\n                var start = dates[i];\r\n                ev2.start = addOffset(start, getTimezoneOffset(start));\r\n\r\n                var end = new Date(start.getTime() + eventLength);\r\n                ev2.end = addOffset(end, getTimezoneOffset(end));\r\n\r\n                node.debug('   ' + i + ': Event (' + JSON.stringify(ev2.exdate) + '):' + ev2.start.toString() + ' ' + ev2.end.toString());\r\n\r\n                var checkDate = true;\r\n                if (ev2.exdate) {\r\n                    for (var d in ev2.exdate) {\r\n                        if (new Date(d).getTime() === ev2.start.getTime()) {\r\n                            checkDate = false;\r\n                            node.debug('   ' + i + ': sort out');\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (checkDate && ev.recurrences) {\r\n                    for (var dOri in ev.recurrences) {\r\n                        if (new Date(dOri).getTime() === ev2.start.getTime()) {\r\n                            ev2 = ce.clone(ev.recurrences[dOri]);\r\n                            node.debug('   ' + i + ': different recurring found replaced with Event:' + ev2.start + ' ' + ev2.end);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (checkDate) {\r\n                    checkDates(ev2, endpreview, today, realnow, ' rrule ', node, config);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function processData(data, realnow, pastview, endpreview, callback, node, config) {\r\n        var processedEntries = 0;\r\n        for (var k in data) {\r\n            var ev = data[k];\r\n            delete data[k];\r\n\r\n            if (ev.summary !== undefined && ev.type === 'VEVENT') {\r\n                if (!ev.end) {\r\n                    ev.end = ce.clone(ev.start);\r\n                    if (!ev.start.getHours() && !ev.start.getMinutes() && !ev.start.getSeconds()) {\r\n                        ev.end.setDate(ev.end.getDate() + 1);\r\n                    }\r\n                }\r\n\r\n                if (ev.rrule === undefined) {\r\n                    checkDates(ev, endpreview, pastview, realnow, ' ', node, config);\r\n                } else {\r\n                    processRRule(ev, endpreview, pastview, realnow, node, config);\r\n                }\r\n            }\r\n\r\n            if (++processedEntries > 100) {\r\n                break;\r\n            }\r\n        }\r\n        if (!Object.keys(data).length) {\r\n            return;\r\n        } else {\r\n            processData(data, realnow, pastview, endpreview, callback, node, config);\r\n        }\r\n    }\r\n\r\n    function checkDates(ev, endpreview, pastview, realnow, rule, node, config: Config) {\r\n        var fullday = false;\r\n        var reason;\r\n        var date;\r\n\r\n        if (ev.summary.hasOwnProperty('val')) {\r\n            reason = ev.summary.val;\r\n        } else {\r\n            reason = ev.summary;\r\n        }\r\n\r\n        var location = ev.location || '';\r\n\r\n        if (!ev.start) return;\r\n        if (!ev.end) ev.end = ev.start;\r\n        ev.start = new Date(ev.start);\r\n        ev.end = new Date(ev.end);\r\n        if (\r\n            !ev.start.getHours() &&\r\n            !ev.start.getMinutes() &&\r\n            !ev.start.getSeconds() &&\r\n            !ev.end.getHours() &&\r\n            !ev.end.getMinutes() &&\r\n            !ev.end.getSeconds()\r\n        ) {\r\n            if (ev.end.getTime() == ev.start.getTime() && ev.datetype == 'date') {\r\n                ev.end.setDate(ev.end.getDate() + 1);\r\n            }\r\n            if (ev.end.getTime() !== ev.start.getTime()) {\r\n                fullday = true;\r\n            }\r\n        }\r\n\r\n        let output = false;\r\n        if (node.trigger == 'match') {\r\n            let regex = new RegExp(node.filter);\r\n            if (regex.test(ev.summary)) output = true;\r\n        } else if (node.trigger == 'nomatch') {\r\n            let regex = new RegExp(node.filter);\r\n            if (!regex.test(ev.summary)) output = true;\r\n        } else {\r\n            output = true;\r\n        }\r\n        if (output) {\r\n            if (fullday) {\r\n                if (\r\n                    (ev.start < endpreview && ev.start >= pastview) ||\r\n                    (ev.end > pastview && ev.end <= endpreview) ||\r\n                    (ev.start < pastview && ev.end > pastview)\r\n                ) {\r\n                    date = formatDate(ev.start, ev.end, true, true, config);\r\n\r\n                    insertSorted(node.datesArray, {\r\n                        date: date.text,\r\n                        summary: ev.summary,\r\n                        topic: ev.summary,\r\n                        calendarName: ev.calendarName,\r\n                        event: reason,\r\n                        eventStart: new Date(ev.start.getTime()),\r\n                        eventEnd: new Date(ev.end.getTime()),\r\n                        description: ev.description,\r\n                        id: ev.uid,\r\n                        allDay: true,\r\n                        rule: rule,\r\n                        location: location,\r\n                        countdown: countdown(new Date(ev.start))\r\n                    });\r\n\r\n                    node.debug('Event (full day) added : ' + JSON.stringify(rule) + ' ' + reason + ' at ' + date.text);\r\n                }\r\n            } else {\r\n                // Event with time              \r\n                if (\r\n                    (ev.start >= pastview && ev.start < endpreview) ||\r\n                    (ev.end >= realnow && ev.end <= endpreview) ||\r\n                    (ev.start < realnow && ev.end > realnow)\r\n                ) {\r\n                    date = formatDate(ev.start, ev.end, true, false, config);\r\n                    insertSorted(node.datesArray, {\r\n                        date: date.text,\r\n                        event: reason,\r\n                        summary: ev.summary,\r\n                        topic: ev.summary,\r\n                        calendarName: ev.calendarName,\r\n                        eventStart: new Date(ev.start.getTime()),\r\n                        eventEnd: new Date(ev.end.getTime()),\r\n                        description: ev.description,\r\n                        id: ev.uid,\r\n                        allDay: false,\r\n                        rule: rule,\r\n                        location: location,\r\n                        countdown: countdown(new Date(ev.start))\r\n                    });\r\n                    node.debug('Event with time added: ' + JSON.stringify(rule) + ' ' + reason + ' at ' + date.text);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function checkICal(urlOrFile, callback, node, config: Config) {\r\n        getICal(node, urlOrFile, config, (err, data) => {\r\n            if (err || !data) {\r\n                callback(err);\r\n                return;\r\n            }\r\n            node.debug('Ical read successfully ' + urlOrFile);\r\n\r\n            try {\r\n                if (data) {\r\n                    var realnow = new Date();\r\n                    var endpreview = new Date();\r\n                    var pastview = new Date();\r\n\r\n                    if (node.endpreviewUnits === 'days' && node.endpreview>=1) {\r\n                        endpreview = moment(endpreview).endOf('day').add(node.endpreview - 1, 'days').toDate();\r\n                    } else {\r\n                        endpreview = moment(endpreview)\r\n                            .add(node.endpreview, node.endpreviewUnits.charAt(0))\r\n                            .toDate();\r\n                    }\r\n                    \r\n                    if (node.pastviewUnits === 'days' && node.pastview>=1) {\r\n                        pastview = moment(pastview).startOf('day').subtract(node.pastview - 1, 'days').toDate();\r\n                    } else {\r\n                        pastview = moment(pastview)\r\n                            .subtract(node.pastview, node.pastviewUnits.charAt(0))\r\n                            .toDate();\r\n                    }\r\n\r\n                    processData(data, realnow, pastview, endpreview, callback, node, config);\r\n                    callback(data);\r\n                } else {\r\n                    callback(null, 'no Data');\r\n                }\r\n            } catch (e) {\r\n                node.debug(JSON.stringify(e));\r\n                callback('no Data' + e);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n    function displayDates(node: any, config: Config) {\r\n        let todayEventcounter = 0;\r\n        let tomorrowEventcounter = 0;\r\n        let today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        let oneDay = 24 * 60 * 60 * 1000;\r\n        let tomorrow = new Date(today.getTime() + oneDay);\r\n        let dayAfterTomorrow = new Date(tomorrow.getTime() + oneDay);\r\n\r\n        for (var t = 0; t < node.datesArray.length; t++) {\r\n            if (node.datesArray[t].eventEnd.getTime() > today.getTime() && node.datesArray[t].eventStart.getTime() < tomorrow.getTime()) {\r\n                todayEventcounter++;\r\n            }\r\n            if (node.datesArray[t].eventEnd.getTime() > tomorrow.getTime() && node.datesArray[t].eventStart.getTime() < dayAfterTomorrow.getTime()) {\r\n                tomorrowEventcounter++;\r\n            }\r\n        }\r\n\r\n        node.send({\r\n            today: todayEventcounter,\r\n            tomorrow: tomorrowEventcounter,\r\n            total: node.datesArray.length,\r\n            htmlTable: brSeparatedList(node.datesArray, config),\r\n            payload: node.datesArray,\r\n        });\r\n    }\r\n\r\n    let dictionary = {\r\n        today: {\r\n            en: 'Today',\r\n            it: 'Oggi',\r\n            es: 'Hoy',\r\n            pl: 'Dzisiaj',\r\n            fr: \"Aujourd'hui\",\r\n            de: 'Heute',\r\n            ru: 'Сегодня',\r\n            nl: 'Vandaag',\r\n        },\r\n        tomorrow: {\r\n            en: 'Tomorrow',\r\n            it: 'Domani',\r\n            es: 'Mañana',\r\n            pl: 'Jutro',\r\n            fr: 'Demain',\r\n            de: 'Morgen',\r\n            ru: 'Завтра',\r\n            nl: 'Morgen',\r\n        },\r\n        dayafter: {\r\n            en: 'Day After Tomorrow',\r\n            it: 'Dopodomani',\r\n            es: 'Pasado mañana',\r\n            pl: 'Pojutrze',\r\n            fr: 'Après demain',\r\n            de: 'Übermorgen',\r\n            ru: 'Послезавтра',\r\n            nl: 'Overmorgen',\r\n        },\r\n        '3days': {\r\n            en: 'In 3 days',\r\n            it: 'In 3 giorni',\r\n            es: 'En 3 días',\r\n            pl: 'W 3 dni',\r\n            fr: 'Dans 3 jours',\r\n            de: 'In 3 Tagen',\r\n            ru: 'Через 2 дня',\r\n            nl: 'Over 3 dagen',\r\n        },\r\n        '4days': {\r\n            en: 'In 4 days',\r\n            it: 'In 4 giorni',\r\n            es: 'En 4 días',\r\n            pl: 'W 4 dni',\r\n            fr: 'Dans 4 jours',\r\n            de: 'In 4 Tagen',\r\n            ru: 'Через 3 дня',\r\n            nl: 'Over 4 dagen',\r\n        },\r\n        '5days': {\r\n            en: 'In 5 days',\r\n            it: 'In 5 giorni',\r\n            es: 'En 5 días',\r\n            pl: 'W ciągu 5 dni',\r\n            fr: 'Dans 5 jours',\r\n            de: 'In 5 Tagen',\r\n            ru: 'Через 4 дня',\r\n            nl: 'Over 5 dagen',\r\n        },\r\n        '6days': {\r\n            en: 'In 6 days',\r\n            it: 'In 6 giorni',\r\n            es: 'En 6 días',\r\n            pl: 'W ciągu 6 dni',\r\n            fr: 'Dans 6 jours',\r\n            de: 'In 6 Tagen',\r\n            ru: 'Через 5 дней',\r\n            nl: 'Over 6 dagen',\r\n        },\r\n        oneweek: {\r\n            en: 'In one week',\r\n            it: 'In una settimana',\r\n            es: 'En una semana',\r\n            pl: 'W jeden tydzień',\r\n            fr: 'Dans une semaine',\r\n            de: 'In einer Woche',\r\n            ru: 'Через неделю',\r\n            nl: 'Binnen een week',\r\n        },\r\n        '1week_left': {\r\n            en: 'One week left',\r\n            it: 'Manca una settimana',\r\n            es: 'Queda una semana',\r\n            pl: 'Został jeden tydzień',\r\n            fr: 'Reste une semaine',\r\n            de: 'Noch eine Woche',\r\n            ru: 'Ещё неделя',\r\n            nl: 'Over een week',\r\n        },\r\n        '2week_left': {\r\n            en: 'Two weeks left',\r\n            it: 'Due settimane rimaste',\r\n            es: 'Dos semanas restantes',\r\n            pl: 'Zostały dwa tygodnie',\r\n            fr: 'Il reste deux semaines',\r\n            de: 'Noch zwei Wochen',\r\n            ru: 'Ещё две недели',\r\n            nl: 'Over twee weken',\r\n        },\r\n        '3week_left': {\r\n            en: 'Three weeks left',\r\n            it: 'Tre settimane rimanenti',\r\n            es: 'Tres semanas quedan',\r\n            pl: 'Pozostały trzy tygodnie',\r\n            fr: 'Trois semaines restantes',\r\n            de: 'Noch drei Wochen',\r\n            ru: 'Ещё три недели',\r\n            nl: 'Over drie weken',\r\n        },\r\n        '4week_left': {\r\n            en: 'Four weeks left',\r\n            it: 'Quattro settimane rimaste',\r\n            es: 'Cuatro semanas quedan',\r\n            pl: 'Pozostały cztery tygodnie',\r\n            fr: 'Quatre semaines à gauche',\r\n            de: 'Noch vier Wochen',\r\n            ru: 'Ещё три недели',\r\n            nl: 'Over vier weken',\r\n        },\r\n        '5week_left': {\r\n            en: 'Five weeks left',\r\n            it: 'Cinque settimane rimaste',\r\n            es: 'Quedan cinco semanas',\r\n            pl: 'Pozostało pięć tygodni',\r\n            fr: 'Cinq semaines à gauche',\r\n            de: 'Noch fünf Wochen',\r\n            ru: 'Ещё пять недель',\r\n            nl: 'Over vijf weken',\r\n        },\r\n        '6week_left': {\r\n            en: 'Six weeks left',\r\n            it: 'Sei settimane a sinistra',\r\n            es: 'Seis semanas restantes',\r\n            pl: 'Pozostało sześć tygodni',\r\n            fr: 'Six semaines à gauche',\r\n            de: 'Noch sechs Wochen',\r\n            ru: 'Ещё шесть недель',\r\n            nl: 'Over zes weken',\r\n        },\r\n        left: {\r\n            en: 'left',\r\n            it: 'sinistra',\r\n            es: 'izquierda',\r\n            pl: 'lewo',\r\n            fr: 'la gauche',\r\n            de: ' ',\r\n            ru: 'осталось',\r\n            nl: 'over',\r\n        },\r\n        still: { en: ' ', it: '', es: '', pl: '', fr: '', de: 'Noch', ru: ' ', nl: 'nog' },\r\n        days: { en: 'days', it: 'Giorni', es: 'dias', pl: 'dni', fr: 'journées', de: 'Tage', ru: 'дней', nl: 'dagen' },\r\n        day: { en: 'day', it: 'giorno', es: 'día', pl: 'dzień', fr: 'journée', de: 'Tag', ru: 'день', nl: 'dag' },\r\n        hours: {\r\n            en: 'hours',\r\n            it: 'ore',\r\n            es: 'horas',\r\n            pl: 'godziny',\r\n            fr: 'heures',\r\n            de: 'Stunden',\r\n            ru: 'часов',\r\n            nl: 'uren',\r\n        },\r\n        hour: { en: 'hour', it: 'ora', es: 'hora', pl: 'godzina', fr: 'heure', de: 'Stunde', ru: 'час', nl: 'uur' },\r\n    };\r\n\r\n    function _(text, config) {\r\n        if (!text) return '';\r\n\r\n        if (dictionary[text]) {\r\n            var newText = dictionary[text][config.language];\r\n            if (newText) {\r\n                return newText;\r\n            } else if (config.language !== 'en') {\r\n                newText = dictionary[text].en;\r\n                if (newText) {\r\n                    return newText;\r\n                }\r\n            }\r\n        }\r\n        return text;\r\n    }\r\n\r\n    function insertSorted(arr: CalEvent[], element: CalEvent) {\r\n        if (!arr.length) {\r\n            arr.push(element);\r\n        } else {\r\n            if (arr[0].eventStart > element.eventStart) {\r\n                arr.unshift(element);\r\n            } else if (arr[arr.length - 1].eventStart < element.eventStart) {\r\n                arr.push(element);\r\n            } else {\r\n                if (arr.length === 1) {\r\n                    arr.push(element);\r\n                } else {\r\n                    for (var i = 0; i < arr.length - 1; i++) {\r\n                        if (arr[i].eventStart <= element.eventStart && element.eventStart < arr[i + 1].eventStart) {\r\n                            arr.splice(i + 1, 0, element);\r\n                            element = null;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (element) arr.push(element);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function brSeparatedList(datesArray: CalEvent[], config) {\r\n        var text = '<span>';\r\n        var today = new Date();\r\n        var tomorrow = new Date();\r\n        var dayafter = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        tomorrow.setDate(today.getDate() + 1);\r\n        tomorrow.setHours(0, 0, 0, 0);\r\n        dayafter.setDate(today.getDate() + 2);\r\n        dayafter.setHours(0, 0, 0, 0);\r\n\r\n        for (var i = 0; i < datesArray.length; i++) {\r\n            var date = formatDate(datesArray[i].eventStart, datesArray[i].eventEnd, true, datesArray[i].allDay, config);\r\n\r\n            if (text) text += '<br/>\\n';\r\n            text += date.text + ' ' + datesArray[i].event + '</span>';\r\n        }\r\n\r\n        return text;\r\n    }\r\n\r\n    function formatDate(_date, _end: Date, withTime, fullday, config) {\r\n        var day = _date.getDate();\r\n        var month = _date.getMonth() + 1;\r\n        var year = _date.getFullYear();\r\n        var endday = _end.getDate();\r\n        var endmonth = _end.getMonth() + 1;\r\n        var endyear = _end.getFullYear();\r\n        var _time = '';\r\n        var alreadyStarted = _date < new Date();\r\n\r\n        if (withTime) {\r\n            var hours = _date.getHours();\r\n            var minutes = _date.getMinutes();\r\n\r\n            if (!alreadyStarted) {\r\n                if (hours < 10) hours = '0' + hours.toString();\r\n                if (minutes < 10) minutes = '0' + minutes.toString();\r\n                _time = ' ' + hours + ':' + minutes;\r\n            }\r\n            var timeDiff = _end.getTime() - _date.getTime();\r\n            if (timeDiff === 0 && hours === 0 && minutes === 0) {\r\n                _time = ' ';\r\n            } else if (timeDiff > 0) {\r\n                if (!alreadyStarted) {\r\n                    _time += '-';\r\n                } else {\r\n                    _time += ' ';\r\n                }\r\n\r\n                var endhours = _end.getHours().toString();\r\n                var endminutes = _end.getMinutes().toString();\r\n\r\n                if (parseInt(endhours) < 10) endhours = '0' + endhours.toString();\r\n\r\n                if (parseInt(endminutes) < 10) endminutes = '0' + endminutes.toString();\r\n                _time += endhours + ':' + endminutes;\r\n\r\n                var startDayEnd = new Date();\r\n                startDayEnd.setFullYear(_date.getFullYear());\r\n                startDayEnd.setMonth(_date.getMonth());\r\n                startDayEnd.setDate(_date.getDate() + 1);\r\n                startDayEnd.setHours(0, 0, 0, 0);\r\n\r\n                if (_end > startDayEnd) {\r\n                    var start = new Date();\r\n                    if (!alreadyStarted) {\r\n                        start.setDate(_date.getDate());\r\n                        start.setMonth(_date.getMonth());\r\n                        start.setFullYear(_date.getFullYear());\r\n                    }\r\n                    start.setHours(0, 0, 1, 0);\r\n                    var fullTimeDiff = timeDiff;\r\n                    timeDiff = _end.getTime() - start.getTime();\r\n\r\n                    if (fullTimeDiff >= 24 * 60 * 60 * 1000) {\r\n                        _time += '+' + Math.floor(timeDiff / (24 * 60 * 60 * 1000));\r\n                    }\r\n                } else if (config.replacedates && _end.getHours() === 0 && _end.getMinutes() === 0) {\r\n                    _time = ' ';\r\n                }\r\n            }\r\n        }\r\n        var _class = '';\r\n        var d = new Date();\r\n        d.setHours(0, 0, 0, 0);\r\n        var d2 = new Date();\r\n        d2.setDate(d.getDate() + 1);\r\n\r\n        var todayOnly = false;\r\n        if (\r\n            day === d.getDate() &&\r\n            month === d.getMonth() + 1 &&\r\n            year === d.getFullYear() &&\r\n            endday === d2.getDate() &&\r\n            endmonth === d2.getMonth() + 1 &&\r\n            endyear === d2.getFullYear() &&\r\n            fullday\r\n        ) {\r\n            todayOnly = true;\r\n        }\r\n\r\n        if (todayOnly || !alreadyStarted) {\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_today';\r\n            }\r\n\r\n            d.setDate(d.getDate() + 1);\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_tomorrow';\r\n            }\r\n\r\n            d.setDate(d.getDate() + 1);\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_dayafter';\r\n            }\r\n\r\n            d.setDate(d.getDate() + 1);\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_3days';\r\n            }\r\n\r\n            d.setDate(d.getDate() + 1);\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_4days';\r\n            }\r\n\r\n            d.setDate(d.getDate() + 1);\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_5days';\r\n            }\r\n\r\n            d.setDate(d.getDate() + 1);\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_6days';\r\n            }\r\n\r\n            d.setDate(d.getDate() + 1);\r\n            if (day === d.getDate() && month === d.getMonth() + 1 && year === d.getFullYear()) {\r\n                _class = 'ical_oneweek';\r\n            }\r\n\r\n            if (config.replacedates) {\r\n                if (_class === 'ical_today')\r\n                    return {\r\n                        text: _('today', config) + _time,\r\n                        _class: _class,\r\n                    };\r\n                if (_class === 'ical_tomorrow') return { text: _('tomorrow', config) + _time, _class: _class };\r\n                if (_class === 'ical_dayafter') return { text: _('dayafter', config) + _time, _class: _class };\r\n                if (_class === 'ical_3days') return { text: _('3days', config) + _time, _class: _class };\r\n                if (_class === 'ical_4days') return { text: _('4days', config) + _time, _class: _class };\r\n                if (_class === 'ical_5days') return { text: _('5days', config) + _time, _class: _class };\r\n                if (_class === 'ical_6days') return { text: _('6days', config) + _time, _class: _class };\r\n                if (_class === 'ical_oneweek') return { text: _('oneweek', config) + _time, _class: _class };\r\n            }\r\n        } else {\r\n            _class = 'ical_today';\r\n            var daysleft = Math.round((_end.getDate() - new Date().getDate()) / (1000 * 60 * 60 * 24));\r\n            var hoursleft = Math.round((_end.getDate() - new Date().getDate()) / (1000 * 60 * 60));\r\n\r\n            if (config.replacedates) {\r\n                var _left = _('left', config) !== ' ' ? ' ' + _('left', config) : '';\r\n                var text;\r\n                if (daysleft === 42) {\r\n                    text = _('6week_left', config);\r\n                } else if (daysleft === 35) {\r\n                    text = _('5week_left', config);\r\n                } else if (daysleft === 28) {\r\n                    text = _('4week_left', config);\r\n                } else if (daysleft === 21) {\r\n                    text = _('3week_left', config);\r\n                } else if (daysleft === 14) {\r\n                    text = _('2week_left', config);\r\n                } else if (daysleft === 7) {\r\n                    text = _('1week_left', config);\r\n                } else if (daysleft >= 1) {\r\n                    if (config.language === 'ru') {\r\n                        var c = daysleft % 10;\r\n                        var cc = Math.floor(daysleft / 10) % 10;\r\n                        if (daysleft === 1) {\r\n                            text = (_('still', config) !== ' ' ? _('still', config) : '') + ' ' + daysleft + ' ' + _('day', config) + _left;\r\n                        } else if (cc > 1 && (c > 1 || c < 5)) {\r\n                            text = (_('still', config) !== ' ' ? _('still', config) : '') + ' ' + daysleft + ' ' + 'дня' + _left;\r\n                        } else {\r\n                            text = (_('still', config) !== ' ' ? _('still', config) : '') + ' ' + daysleft + ' ' + _('days', config) + _left;\r\n                        }\r\n                    } else {\r\n                        text =\r\n                            (_('still', config) !== ' ' ? _('still', config) : '') +\r\n                            ' ' +\r\n                            daysleft +\r\n                            ' ' +\r\n                            (daysleft === 1 ? _('day', config) : _('days', config)) +\r\n                            _left;\r\n                    }\r\n                } else {\r\n                    if (config.language === 'ru') {\r\n                        var c = hoursleft % 10;\r\n                        var cc = Math.floor(hoursleft / 10) % 10;\r\n                        if (hoursleft === 1) {\r\n                            text = (_('still', config) !== ' ' ? _('still', config) : '') + ' ' + hoursleft + ' ' + _('hour', config) + _left;\r\n                        } else if (cc !== 1 && (c > 1 || c < 5)) {\r\n                            text = (_('still', config) !== ' ' ? _('still', config) : '') + ' ' + hoursleft + ' ' + 'часа' + _left;\r\n                        } else {\r\n                            text = (_('still', config) !== ' ' ? _('still', config) : '') + ' ' + hoursleft + ' ' + _('hours', config) + _left;\r\n                        }\r\n                    } else {\r\n                        text =\r\n                            (_('still', config) !== ' ' ? _('still', config) : '') +\r\n                            ' ' +\r\n                            hoursleft +\r\n                            ' ' +\r\n                            (hoursleft === 1 ? _('hour', config) : _('hours', config)) +\r\n                            _left;\r\n                    }\r\n                }\r\n            } else {\r\n                day = _end.getDate();\r\n                month = _end.getMonth() + 1;\r\n                year = _end.getFullYear();\r\n\r\n                if (day < 10) day = '0' + day.toString();\r\n                if (month < 10) month = '0' + month.toString();\r\n\r\n                text = day + '.' + month + '.';\r\n                text += year;\r\n\r\n                if (withTime) {\r\n                    let endhours = _end.getHours().toString();\r\n                    let endminutes = _end.getMinutes().toString();\r\n\r\n                    if (parseInt(endhours) < 10) {\r\n                        endhours = '0' + endhours.toString();\r\n                    }\r\n                    if (parseInt(endminutes) < 10) {\r\n                        endminutes = '0' + endminutes.toString();\r\n                    }\r\n                    text += ' ' + endhours + ':' + endminutes;\r\n                }\r\n            }\r\n\r\n            return { text: text, _class: _class };\r\n        }\r\n\r\n        if (day < 10) day = '0' + day.toString();\r\n        if (month < 10) month = '0' + month.toString();\r\n\r\n        return {\r\n            text: day + '.' + month + '.' + year + _time,\r\n            _class: _class,\r\n        };\r\n    }\r\n\r\n    RED.nodes.registerType('ical-upcoming', upcomingNode);\r\n};\r\n"]}